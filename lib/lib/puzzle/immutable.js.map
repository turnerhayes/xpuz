{"version":3,"sources":["../../../src/lib/puzzle/immutable.js"],"names":["require","List","Map","Record","is","Collection","fromJS","PuzzleMixin","infoSchema","title","author","publisher","copyright","difficulty","intro","PuzzleInfo","schema","grid","clues","across","down","userSolution","info","extensions","ImmutablePuzzle","processGrid","args","map","row","cell","get","constructor","equalityTest","getter","obj","path","getIn","setter","value","setIn","sizeOf","size","oldProcessGrid","withMutations","gridWithMutations","exports","module"],"mappings":";;;;;;;;eAOoBA,QAAQ,WAAR,C;IANnBC,I,YAAAA,I;IACAC,G,YAAAA,G;IACAC,M,YAAAA,M;IACAC,E,YAAAA,E;IACAC,U,YAAAA,U;IACAC,M,YAAAA,M;;AAED,IAAMC,cAAcP,QAAQ,iBAAR,CAApB;;AAEA,IAAMQ,aAAa;AAClBC,QAAO,EADW;AAElBC,SAAQ,EAFU;AAGlBC,YAAW,EAHO;AAIlBC,YAAW,EAJO;AAKlBC,aAAY,EALM;AAMlBC,QAAO;AANW,CAAnB;;IASMC,U;;;;;;;;;;EAAmBZ,OAAOK,UAAP,EAAmB,YAAnB,C;;AAEzB,IAAMQ,SAAS;AACdC,OAAMhB,MADQ;AAEdiB,QAAOhB,IAAI;AACViB,UAAQjB,KADE;AAEVkB,QAAMlB;AAFI,EAAJ,CAFO;AAMdmB,eAAcpB,MANA;AAOdqB,OAAM,IAAIP,UAAJ,EAPQ;AAQdQ,aAAYrB;AARE,CAAf;;AAWA;;;;;;;;;IAQMsB,e;;;AACL;;;;;;;;;;;AAWA,gCAMG;AAAA,MALFP,IAKE,QALFA,IAKE;AAAA,MAJFC,KAIE,QAJFA,KAIE;AAAA,MAHFG,YAGE,QAHFA,YAGE;AAAA,MAFFC,IAEE,QAFFA,IAEE;AAAA,MADFC,UACE,QADFA,UACE;;AAAA;;AACF,MAAI,EAAED,gBAAgBP,UAAlB,CAAJ,EAAmC;AAClCO,UAAO,IAAIP,UAAJ,CAAeO,IAAf,CAAP;AACA;;AAEDL,SAAOA,OAAOO,gBAAgBC,WAAhB,CAA4BnB,OAAOW,IAAP,CAA5B,CAAP,GAAmDhB,MAA1D;;AAEA,MAAMyB,OAAO;AACZJ,aADY;AAEZL,aAFY;AAGZI,iBAAcA,eACbf,OAAOe,YAAP,CADa,GAEbJ,KAAKU,GAAL,CACC,UAACC,GAAD;AAAA,WAASA,IAAID,GAAJ,CACR,UAACE,IAAD;AAAA,YAAUA,KAAKC,GAAL,CAAS,aAAT,IAA0B,IAA1B,GAAiC,EAA3C;AAAA,KADQ,CAAT;AAAA,IADD;AALW,GAAb;;AAYA,MAAIZ,KAAJ,EAAW;AACVQ,QAAKR,KAAL,GAAaZ,OAAOY,KAAP,CAAb;AACA;;AAED,MAAIK,UAAJ,EAAgB;AACfG,QAAKH,UAAL,GAAkBjB,OAAOiB,UAAP,CAAlB;AACA;;AAzBC,2HA2BIG,IA3BJ;AA4BF;;AAED;;;;;;;;;EAhD6BvB,OAAOa,MAAP,EAAe,iBAAf,C;;AAwD9BT,YAAY;AACXwB,cAAaP,eADF;AAEXQ,eAAc5B,EAFH;AAGX6B,SAAQ,gBAACC,GAAD,EAAMC,IAAN;AAAA,SAAeD,IAAIE,KAAJ,CAAUD,IAAV,CAAf;AAAA,EAHG;AAIXE,SAAQ,gBAACH,GAAD,EAAMC,IAAN,EAAYG,KAAZ;AAAA,SAAsBJ,IAAIK,KAAJ,CAAUJ,IAAV,EAAgBG,iBAAiBjC,UAAjB,GAA8BiC,KAA9B,GAAsChC,OAAOgC,KAAP,CAAtD,CAAtB;AAAA,EAJG;AAKXE,SAAQ,gBAACN,GAAD;AAAA,SAASA,IAAIO,IAAb;AAAA;AALG,CAAZ;;AAQA,IAAMC,iBAAiBlB,gBAAgBC,WAAvC;;AAEAD,gBAAgBC,WAAhB,GAA8B,SAASA,WAAT,CAAqBR,IAArB,EAA2B;AACxD,QAAOA,KAAK0B,aAAL,CACN,UAACC,iBAAD;AAAA,SAAuBF,eAAeE,iBAAf,CAAvB;AAAA,EADM,CAAP;AAGA,CAJD;;AAMAC,UAAUC,OAAOD,OAAP,GAAiBrB,eAA3B","file":"immutable.js","sourcesContent":["const {\n\tList,\n\tMap,\n\tRecord,\n\tis,\n\tCollection,\n\tfromJS\n}                 = require(\"immutable\");\nconst PuzzleMixin = require(\"../puzzle-mixin\");\n\nconst infoSchema = {\n\ttitle: \"\",\n\tauthor: \"\",\n\tpublisher: \"\",\n\tcopyright: \"\",\n\tdifficulty: \"\",\n\tintro: \"\",\n};\n\nclass PuzzleInfo extends Record(infoSchema, \"PuzzleInfo\") {}\n\nconst schema = {\n\tgrid: List(),\n\tclues: Map({\n\t\tacross: Map(),\n\t\tdown: Map(),\n\t}),\n\tuserSolution: List(),\n\tinfo: new PuzzleInfo(),\n\textensions: Map(),\n};\n\n/**\n * Represents an immutable version of {@link xpuz.Puzzle|Puzzle}.\n *\n * @extends external:Immutable.Record\n * @memberof xpuz\n *\n * @mixes xpuz.PuzzleMixin\n */\nclass ImmutablePuzzle extends Record(schema, \"ImmutablePuzzle\") {\n\t/**\n\t * @param {object} args - the constructor arguments\n\t * @param {Types.ImmutableGrid|Types.Grid} args.grid - the grid for the puzzle\n\t * @param {{across: object, down: object}|external:Immutable.Map<{across: external:Immutable.Map, down: external:Immutable.Map}>} args.clues - the\n\t *\tpuzzle clues\n\t * @param {Array<string[]>|external:Immutable.List<external:Immutable.List<string>>} [args.userSolution] - the guesses that the user\n\t *\thas entered for this puzzle, as a two-dimensional array of array of strings with the same dimensions as the `grid` where\n\t *\teach cell is either a string with the user's input or `null` if it corresponds to a block cell in the grid\n\t * @param {xpuz.PuzzleInfo|object} [args.info] - information about the puzzle\n\t * @param {object} [args.extensions] - a store of extra, possibly implementation-dependent information about the puzzle (such as timer information)\n\t */\n\tconstructor({\n\t\tgrid,\n\t\tclues,\n\t\tuserSolution,\n\t\tinfo,\n\t\textensions\n\t}) {\n\t\tif (!(info instanceof PuzzleInfo)) {\n\t\t\tinfo = new PuzzleInfo(info);\n\t\t}\n\n\t\tgrid = grid ? ImmutablePuzzle.processGrid(fromJS(grid)) : List();\n\n\t\tconst args = {\n\t\t\tinfo,\n\t\t\tgrid,\n\t\t\tuserSolution: userSolution ?\n\t\t\t\tfromJS(userSolution) :\n\t\t\t\tgrid.map(\n\t\t\t\t\t(row) => row.map(\n\t\t\t\t\t\t(cell) => cell.get(\"isBlockCell\") ? null : \"\"\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t};\n\n\t\tif (clues) {\n\t\t\targs.clues = fromJS(clues);\n\t\t}\n\n\t\tif (extensions) {\n\t\t\targs.extensions = fromJS(extensions);\n\t\t}\n\n\t\tsuper(args);\n\t}\n\n\t/**\n\t * The grid for this puzzle\n\t *\n\t * @member {Types.ImmutableGrid} grid\n\t * @instance\n\t */\n}\n\nPuzzleMixin({\n\tconstructor: ImmutablePuzzle,\n\tequalityTest: is,\n\tgetter: (obj, path) => obj.getIn(path),\n\tsetter: (obj, path, value) => obj.setIn(path, value instanceof Collection ? value : fromJS(value)),\n\tsizeOf: (obj) => obj.size,\n});\n\nconst oldProcessGrid = ImmutablePuzzle.processGrid;\n\nImmutablePuzzle.processGrid = function processGrid(grid) {\n\treturn grid.withMutations(\n\t\t(gridWithMutations) => oldProcessGrid(gridWithMutations)\n\t);\n};\n\nexports = module.exports = ImmutablePuzzle;\n"]}